<head>
  <meta charset="UTF-8">
</head>
<body></body>
<script type="module">
import { _if } from '../if.js'
import { iter } from '../iter.js'
import { State, get } from '../state.js'
import { div, button } from './bindings.js'

const count = new State(0, {
  actions: {
    increment: v => v + 1,
    decrement: v => v - 1,
  },
})

const items = new State([
  { name: 'foo' },
  { name: 'bar' },
  { name: 'baz' },
  { name: 'qux' },
  { name: 'quux' },
], {
  key: item => item.name,
  actions: {
    add: v => [...v, { name: performance.now() }],
    del: (v, name) => v.filter(x => x.name !== name),
    reverse: v => [...v].reverse(),
  },
})

const dynamicEl = new State(
  div('A dynamic el')
)
const dynamicAttr = new State('sample-text')

setTimeout(() => {
  dynamicEl.v = button('Tada')
  dynamicAttr.v = 'reactive-text'
}, 3000)

const app =
  div('.class', '@name', '#id')
    (get`The count is: ${count}`)
    (div().attr('data-something', dynamicAttr)
      (dynamicEl)
    )
    (_if(count.gt(0))
      (div('Positive'))
    .elif(count.eq(0))
      (div('Zero'))
    .elif(count.eq(-1))
      (div('Minus one'))
    .else()
      (div('Very negative'))
    )
    (button('Increment').click(count.increment))
    (button('Decrement').click(count.decrement))
    (_if(count.ge(2))
      (div('Boo!'))
      (div('Boo!'))
    )
    (button('Add').click(items.add))
    (iter(items, item =>
      div(get`${item._`i`} - ${item._`name`}`).click(() => items.del(item.v.name))
    ))

app.connect(document.body)
</script>